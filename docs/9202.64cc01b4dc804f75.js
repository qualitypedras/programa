"use strict";(self.webpackChunksakai_ng=self.webpackChunksakai_ng||[]).push([[9202],{9202:(ce,U,m)=>{m.r(U),m.d(U,{CriarOrcamentoModule:()=>re});var I=m(6895),l=m(433),g=m(7001),x=m(5861),N=m(919),e=m(4650),q=m(3101),G=m(1205);let O=(()=>{class o{constructor(t,n,i,c){this.afs=t,this.afAuth=n,this.router=i,this.ngZone=c}SaveOrcamento(t){const n=this.afs.doc(`orcamentos/${t.uid}`);this.afs.collection("orcamentos").doc(t.uid).ref.get().then(i=>n.set(t,{merge:!0})).catch(i=>console.error(i))}GetOrcamento(t){var n=this;return(0,x.Z)(function*(){n.afs.collection("orcamentos").doc(t).ref.get().then(i=>i.data()).catch(i=>console.error(i))})()}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(q.ST),e.LFG(G.zQ),e.LFG(g.F0),e.LFG(e.R0b))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();const E={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let Z;const R=new Uint8Array(16);function V(){if(!Z&&(Z=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Z))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Z(R)}const s=[];for(let o=0;o<256;++o)s.push((o+256).toString(16).slice(1));const j=function Y(o,a,t){if(E.randomUUID&&!a&&!o)return E.randomUUID();const n=(o=o||{}).random||(o.rng||V)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,a){t=t||0;for(let i=0;i<16;++i)a[t+i]=n[i];return a}return function F(o,a=0){return(s[o[a+0]]+s[o[a+1]]+s[o[a+2]]+s[o[a+3]]+"-"+s[o[a+4]]+s[o[a+5]]+"-"+s[o[a+6]]+s[o[a+7]]+"-"+s[o[a+8]]+s[o[a+9]]+"-"+s[o[a+10]]+s[o[a+11]]+s[o[a+12]]+s[o[a+13]]+s[o[a+14]]+s[o[a+15]]).toLowerCase()}(n)};var S=m(5439),$=m(529),v=m(805),T=m(585),D=m(5593),k=m(1740),J=m(5047),M=m(3054),w=m(5108),B=m(2453),z=m(2137);function Q(o,a){if(1&o){const t=e.EpF();e.ynx(0,43)(1,36),e.TgZ(2,"div",37)(3,"label",44),e._uU(4," Especifica\xe7\xe3o "),e.qZA(),e.TgZ(5,"textarea",45),e._uU(6,"                                        "),e.qZA()(),e.TgZ(7,"div",5)(8,"label",44),e._uU(9," Material "),e.qZA(),e._UZ(10,"input",46),e.qZA(),e.TgZ(11,"div",47)(12,"label",44),e._uU(13," Quant. "),e.qZA(),e._UZ(14,"input",48),e.qZA(),e.TgZ(15,"div",49)(16,"label",44),e._uU(17," Medida (cm) "),e.qZA(),e._UZ(18,"input",50),e.qZA(),e.TgZ(19,"div",10)(20,"label",44),e._uU(21," Valor "),e.qZA(),e._UZ(22,"p-inputNumber",51),e.qZA(),e.TgZ(23,"div",52)(24,"button",53),e.NdJ("click",function(){const c=e.CHM(t).index,r=e.oxw().index,u=e.oxw();return e.KtG(u.duplicarItem(r,c))}),e._uU(25," Duplicar Item "),e.qZA(),e.TgZ(26,"button",54),e.NdJ("click",function(){const c=e.CHM(t).index,r=e.oxw().index,u=e.oxw();return e.KtG(u.removerItem(r,c))}),e._uU(27," Remover Item "),e.qZA()(),e.BQk(),e.TgZ(28,"div",1),e._UZ(29,"p-divider"),e.qZA(),e.BQk()}if(2&o){const t=a.index;e.xp6(1),e.s9C("formGroupName",t)}}function L(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",34)(1,"div",35),e.ynx(2,36),e.TgZ(3,"div",37)(4,"label"),e._uU(5,"Ambiente"),e.qZA(),e._UZ(6,"input",38),e.qZA(),e.YNc(7,Q,30,1,"ng-container",39),e.TgZ(8,"div",40)(9,"button",41),e.NdJ("click",function(){const c=e.CHM(t).index,r=e.oxw();return e.KtG(r.adicionarItem(c))}),e._uU(10," Adicionar Item "),e.qZA(),e.TgZ(11,"button",42),e.NdJ("click",function(){const c=e.CHM(t).index,r=e.oxw();return e.KtG(r.removerAmbiente(c))}),e._uU(12," Remover Ambiente "),e.qZA()(),e.BQk(),e.qZA()()}if(2&o){const t=a.index,n=e.oxw();e.xp6(2),e.s9C("formGroupName",t),e.xp6(5),e.Q6J("ngForOf",n.getItensAmbiente(t))}}function H(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"button",55),e.NdJ("click",function(){e.CHM(t),e.oxw();const i=e.MAs(73);return e.KtG(i.reject())}),e.qZA(),e.TgZ(1,"button",56),e.NdJ("click",function(){e.CHM(t),e.oxw();const i=e.MAs(73);return e.KtG(i.accept())}),e.qZA()}}const P=function(){return{width:"50vw"}};let K=(()=>{class o{constructor(t,n,i,c,r,u,f,C,b){var d;this.fb=t,this.auth=n,this.orcamentoService=i,this.route=c,this.http=r,this.afs=u,this.confirmationService=f,this.messageService=C,this.router=b,this.form=this.fb.group({nomeCliente:["",[l.kI.required]],telCliente:["",[l.kI.required]],cepCliente:[""],enderecoCliente:[""],numeroEnderecoCliente:[""],cidadeCliente:[""],estadoCliente:[""],complementoCliente:[""],dataEnvio:[S(new Date).toDate(),[l.kI.required]],dataCriacao:[(new Date).toLocaleString(),[l.kI.required]],atendente:["",[l.kI.required]],informacaoAdicional:[""],observacao:[""],ambientes:this.fb.array([])}),this.loading=!1,this.maxDate=new Date,null===(d=this.form.get("atendente"))||void 0===d||d.setValue(n.user.displayName)}ngOnInit(){var n,t=this;this.route.queryParams.subscribe(function(){var i=(0,x.Z)(function*(c){const r=c.id;t.orcamentoId=r,r&&t.afs.collection("orcamentos").doc(r).ref.get().then(u=>{var f,C,b,d,A,_;if(u.exists&&(t.orcamento=u.data(),!(null===(f=t.orcamento.dataEnvio)||void 0===f)&&f.seconds&&(t.orcamento.dataEnvio=S(1e3*t.orcamento.dataEnvio.seconds).toDate()),t.form.patchValue(t.orcamento,{emitEvent:!1}),null!==(C=t.orcamento)&&void 0!==C&&C.ambientes)){const ae=t.form.get("ambientes");for(let p=0;p<(null===(b=t.orcamento)||void 0===b?void 0:b.ambientes.length);p++){ae.push(t.fb.group({descricao:[null===(d=t.orcamento)||void 0===d?void 0:d.ambientes[p].descricao],itens:t.fb.array([])}));for(let y=0;y<(null===(A=t.orcamento)||void 0===A?void 0:A.ambientes[p].itens.length);y++){const h=null===(_=t.orcamento)||void 0===_?void 0:_.ambientes[p].itens[y];t.form.get("ambientes").at(p).get("itens").push(t.fb.group({quantidade:[h.quantidade],especificacao:[h.especificacao],material:[h.material],medida:[h.medida],valor:[h.valor]}))}}}}).catch(u=>console.error(u))});return function(c){return i.apply(this,arguments)}}()),null===(n=this.form.get("cepCliente"))||void 0===n||n.valueChanges.subscribe({next:i=>{const c=i?.replace(/[^\d]/g,"");c&&8==c.length&&this.http.get(`https://viacep.com.br/ws/${c}/json/`).subscribe(r=>{this.form.patchValue({enderecoCliente:r.logradouro,numeroEnderecoCliente:r.numero,cidadeCliente:r.localidade,estadoCliente:r.uf})})}})}toTitleCase(t){var n;const c=t.target.value.replace(/\w\S*/g,function(r){return r.charAt(0).toUpperCase()+r.substr(1).toLowerCase()});null===(n=this.form.get("nomeCliente"))||void 0===n||n.setValue(c)}phoneMaskBrazil(t){var i=t.target;/\d|Backspace|Tab/.test(t.key)||t.preventDefault();var r=i.value;r=(r=(r=r.replace(/\D/g,"")).replace(/(^\d{2})(\d)/,"($1) $2")).replace(/(\d{4,5})(\d{4}$)/,"$1-$2"),i.value=r}zipCodeMask(t){let n=t.target.value;n&&(n=n.replace(/\D/g,""),n=n.replace(/(\d{5})(\d)/,"$1-$2"),t.target.value=n)}removerAmbiente(t){var n;const i=this.form.get("ambientes");this.confirmationService.confirm({message:`Tem certeza que deseja excluir o ambiente <strong>${null===(n=i.at(t).value.descricao)||void 0===n?void 0:n.toUpperCase()}</strong>? `,header:"Confirma\xe7\xe3o",icon:"pi pi-exclamation-triangle",accept:()=>{i.removeAt(t),this.messageService.add({severity:"info",summary:"Sucesso!",detail:"Ambiente exclu\xeddo."})}})}removerItem(t,n){var i;const r=this.form.get("ambientes").at(t).get("itens");this.confirmationService.confirm({message:`Voc\xea tem certeza que deseja excluir o item <strong>${null===(i=r.at(n).get("especificacao"))||void 0===i?void 0:i.value.toUpperCase()}</strong>? `,header:"Confirma\xe7\xe3o",icon:"pi pi-exclamation-triangle",accept:()=>{r.removeAt(n),this.messageService.add({severity:"info",summary:"Sucesso!",detail:"Item exclu\xeddo."})}})}duplicarItem(t,n){const c=this.form.get("ambientes").at(t).get("itens"),r=c.at(n);c.push(this.fb.group({quantidade:[r.controls.quantidade.value],especificacao:[r.controls.especificacao.value],material:[r.controls.material.value],medida:[r.controls.medida.value],valor:[r.controls.valor.value]}))}adicionarAmbiente(){this.form.get("ambientes").push(this.fb.group({descricao:[""],itens:this.fb.array([])}))}getItensAmbiente(t){return this.form.get("ambientes").at(t).get("itens").controls}adicionarItem(t){this.form.get("ambientes").at(t).get("itens").push(this.fb.group({quantidade:[1],especificacao:[""],material:[""],medida:[""],valor:[""]}))}enviar(){var t=this;return(0,x.Z)(function*(){var n;t.loading=!0,yield t.confirmationService.confirm({message:`O atendente salvo ser\xe1 <strong>${null===(n=t.form.get("atendente"))||void 0===n?void 0:n.value}</strong>. Deseja continuar?`,header:"Confirma\xe7\xe3o",icon:"pi pi-exclamation-triangle",accept:()=>{let i=t.form.value;i.valorTotal=t.getValorTotalItens(),i.status="CRIADO",t.orcamentoId||(i.uid=j()),t.orcamentoId&&(i.uid=t.orcamentoId),t.orcamentoService.SaveOrcamento(i),t.messageService.add({severity:"info",summary:"Sucesso!",detail:"Or\xe7amento salvo. Redirecionando..."}),setTimeout(()=>{t.router.navigate(["/orcamentos/pesquisar"])},1500)}}),t.loading=!1})()}getAmbientes(){return this.form.get("ambientes").controls}log(t){console.log(t)}getValorTotalItens(){let t=0;return this.form.get("ambientes").controls.forEach(i=>{i&&i.controls.itens.controls.forEach(r=>{t+=Number(r.controls.valor.value.replace("R$","").replace(".","").replace(",","."))})}),t}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(l.qu),e.Y36(N.e),e.Y36(O),e.Y36(g.gz),e.Y36($.eN),e.Y36(q.ST),e.Y36(v.YP),e.Y36(v.ez),e.Y36(g.F0))},o.\u0275cmp=e.Xpm({type:o,selectors:[["ng-component"]],features:[e._Bn([N.e,O])],decls:75,vars:9,consts:[[1,"grid"],[1,"col-12"],[1,"card"],[3,"formGroup"],[1,"p-fluid","p-formgrid","grid"],[1,"field","col-12","md:col-6"],["htmlFor","firstname2"],["pInputText","","formControlName","nomeCliente","type","text",3,"input"],["htmlFor","lastname2"],["pInputText","","formControlName","telCliente","type","tel","maxlength","15",3,"input"],[1,"field","col-12","md:col-2"],["htmlFor","zip"],["pInputText","","formControlName","cepCliente","type","text","maxlength","9",3,"input"],[1,"field","col-12","md:col-4"],["htmlFor","address"],["pInputTextarea","","formControlName","enderecoCliente"],[1,"field","col-12","md:col-3"],["htmlFor","city"],["pInputText","","id","city","formControlName","cidadeCliente","type","text"],["htmlFor","estado"],["pInputText","","id","estado","formControlName","estadoCliente","type","text"],["pInputText","","id","numero","formControlName","numeroEnderecoCliente","type","text"],["pInputText","","id","complemento","formControlName","complementoCliente","type","text"],["class","shadow-1 mb-3 mt-3","formArrayName","ambientes",4,"ngFor","ngForOf"],["pButton","",1,"p-element","p-button-success","p-button","p-component",2,"width","160px",3,"click"],["formControlName","dataEnvio","dateFormat","dd/mm/yy",3,"showIcon","maxDate","defaultDate"],[1,"field","col-12","md:col-8"],["pInputText","","formControlName","atendente","type","text",3,"input"],[1,"field","col-12","md:col-12"],["pInputTextarea","","formControlName","informacaoAdicional","type","text"],["pInputTextarea","","formControlName","observacao","type","text"],["label","Salvar","icon","pi pi-check","pRipple","",1,"p-button-lg",3,"loading","onClick"],["cd",""],["pTemplate","footer"],["formArrayName","ambientes",1,"shadow-1","mb-3","mt-3"],[1,"p-fluid","p-formgrid","grid","col-12"],[3,"formGroupName"],[1,"field","col-12"],["pInputText","","formControlName","descricao","type","text"],["formArrayName","itens",4,"ngFor","ngForOf"],[1,"col-12","flex","justify-content-between","align-items-center"],["pButton","",1,"w-10rem","m-1","p-button-success","p-button","p-component","text-center",3,"click"],["pButton","",1,"w-12rem","m-1","p-button-danger","p-button","p-component",3,"click"],["formArrayName","itens"],["htmlFor","grid-password"],["pInputTextarea","","formControlName","especificacao","type","text"],["formControlName","material","type","text","pInputText",""],[1,"field","col-4","md:col-1"],["formControlName","quantidade","type","number","pKeyFilter","int","min","1","pInputText",""],[1,"field","col-8","md:col-3"],["formControlName","medida","type","text","pInputText",""],["formControlName","valor","mode","currency","inputId","currency-brl","currency","BRL"],[1,"w-full","flex","align-items-center","justify-content-end"],["pButton","",1,"w-9rem","m-1","p-button-primary","p-button","p-component","text-center",3,"click"],["pButton","","pButton","",1,"w-9rem","m-1","p-button-danger","p-button","p-component",3,"click"],["type","button","pButton","","icon","pi pi-times","label","N\xe3o",3,"click"],["type","button","pButton","","icon","pi pi-check","label","Sim",3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h5"),e._uU(4,"Criar Or\xe7amento"),e.qZA(),e.TgZ(5,"form",3)(6,"h5"),e._uU(7,"Cliente"),e.qZA(),e.TgZ(8,"div",4)(9,"div",5)(10,"label",6),e._uU(11,"Nome"),e.qZA(),e.TgZ(12,"input",7),e.NdJ("input",function(c){return n.toTitleCase(c)}),e.qZA()(),e.TgZ(13,"div",5)(14,"label",8),e._uU(15,"Telefone"),e.qZA(),e.TgZ(16,"input",9),e.NdJ("input",function(c){return n.phoneMaskBrazil(c)}),e.qZA()(),e.TgZ(17,"div",10)(18,"label",11),e._uU(19,"CEP"),e.qZA(),e.TgZ(20,"input",12),e.NdJ("input",function(c){return n.zipCodeMask(c)}),e.qZA()(),e.TgZ(21,"div",13)(22,"label",14),e._uU(23,"Endere\xe7o"),e.qZA(),e._UZ(24,"input",15),e.qZA(),e.TgZ(25,"div",16)(26,"label",17),e._uU(27,"Cidade"),e.qZA(),e._UZ(28,"input",18),e.qZA(),e.TgZ(29,"div",16)(30,"label",19),e._uU(31,"Estado"),e.qZA(),e._UZ(32,"input",20),e.qZA(),e.TgZ(33,"div",5)(34,"label",19),e._uU(35,"N\xfamero"),e.qZA(),e._UZ(36,"input",21),e.qZA(),e.TgZ(37,"div",5)(38,"label",19),e._uU(39,"Complemento"),e.qZA(),e._UZ(40,"input",22),e.qZA()(),e._UZ(41,"p-divider"),e.TgZ(42,"h5"),e._uU(43,"Informa\xe7\xf5es"),e.qZA(),e.YNc(44,L,13,2,"div",23),e.TgZ(45,"button",24),e.NdJ("click",function(){return n.adicionarAmbiente()}),e._uU(46," Adicionar Ambiente "),e.qZA(),e._UZ(47,"p-divider"),e.TgZ(48,"h5"),e._uU(49,"Adicionais"),e.qZA(),e.TgZ(50,"div",4)(51,"div",13)(52,"label",6),e._uU(53,"Data de envio"),e.qZA(),e._UZ(54,"p-calendar",25),e.qZA(),e.TgZ(55,"div",26)(56,"label",6),e._uU(57,"Atendente"),e.qZA(),e.TgZ(58,"input",27),e.NdJ("input",function(c){return n.toTitleCase(c)}),e.qZA()(),e.TgZ(59,"div",28)(60,"label"),e._uU(61,"Informa\xe7\xe3o Adicional"),e.qZA(),e.TgZ(62,"textarea",29),e._uU(63,"                        "),e.qZA()(),e.TgZ(64,"div",28)(65,"label"),e._uU(66,"Observa\xe7\xe3o (somente funcion\xe1rios conseguem ver)"),e.qZA(),e.TgZ(67,"textarea",30),e._uU(68,"                        "),e.qZA()()(),e._UZ(69,"p-divider"),e.TgZ(70,"p-button",31),e.NdJ("onClick",function(){return n.enviar()}),e.qZA(),e._UZ(71,"p-toast"),e.TgZ(72,"p-confirmDialog",null,32),e.YNc(74,H,2,0,"ng-template",33),e.qZA()()()()()),2&t&&(e.xp6(5),e.Q6J("formGroup",n.form),e.xp6(39),e.Q6J("ngForOf",n.getAmbientes()),e.xp6(10),e.Q6J("showIcon",!0)("maxDate",n.maxDate)("defaultDate",n.maxDate),e.xp6(16),e.Q6J("loading",n.loading),e.xp6(2),e.Akn(e.DdM(8,P)))},dependencies:[I.sg,l._Y,l.Fj,l.wV,l.JJ,l.JL,l.nD,l.qQ,v.jx,T.f,D.Hq,D.zx,k.o,J.Rn,M.g,l.sg,l.u,l.x0,l.CE,w.i,B.FN,z.Q],encapsulation:2}),o})(),X=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[g.Bz.forChild([{path:"",component:K}]),g.Bz]}),o})();var W=m(3631),ee=m(9766),te=m(2210),ne=m(3520),oe=m(1118),ie=m(5722);let re=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({providers:[v.YP,v.ez],imports:[I.ez,l.u5,X,W.WN,T._8,ee.Gg,te.kW,ne.zz,J.L$,oe.XH,ie.q4,M.A,k.j,l.u5,l.UX,w.x,T._8,B.EV,z.D]}),o})()}}]);